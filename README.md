# 豆瓣帖子爬虫与情感分析系统

一个完整的豆瓣小组帖子爬取、解析和情感分析系统。

## 功能特性

### 1. 数据爬取
- 爬取豆瓣小组帖子列表
- 下载帖子详细内容和评论
- 自动保存为JSON格式

### 2. 数据解析
- 提取帖子标题、内容、作者信息
- 提取评论内容、评论者信息、时间等
- 结构化数据存储

### 3. 情感分析
- 多维度情感分析
- 关键词提取
- 时间维度分析
- 作者维度分析

### 4. 可视化展示
- Web界面展示分析结果
- 多种图表类型（饼图、柱状图、折线图等）
- 实时数据刷新

## 项目结构

```
.
├── crawl/              # 爬虫模块
│   ├── main.py        # 主爬虫程序
│   ├── get_list.py    # 获取帖子列表
│   └── parser.py      # 解析HTML
├── analyze/            # 情感分析模块
│   ├── sentiment_analyzer.py  # 情感分析器
│   ├── api_server.py   # API服务器
│   └── run_analysis.py # 快速分析脚本
├── frontend/           # 前端界面
│   └── index.html     # 可视化页面
├── data/               # 数据目录
└── docs/               # 文档目录
```

## 安装

### 安装Python依赖

```bash
pip install -r requirements.txt
```

## 使用方法

### 快速开始（推荐）

使用交互式脚本快速启动：

```bash
./run.sh
```

脚本会引导你选择：
- **本地模式**：爬取本地保存的HTML文件（适合网站不稳定时）
- **远程模式**：从豆瓣网站实时爬取数据

### 1. 爬取数据

#### 方式一：使用Python脚本（推荐）

```bash
# 一键运行（远程模式）
python run.py

# 本地模式 - 爬取本地HTML文件
python run.py --mode local --file response.html

# 远程模式 - 自定义小组和页码
python run.py --mode remote --group-id 724338 --page 0

# 只爬取数据，不进行分析
python run.py --skip-analysis --skip-server
```

#### 方式二：直接调用爬虫模块

```bash
cd crawl

# 远程模式（默认）
python main.py

# 本地模式
python main.py --mode local --file response.html

# 自定义小组和页码
python main.py --mode remote --group-id 724338 --page 0
```

**说明**：
- 数据会自动保存到项目根目录的 `data/` 文件夹
- 无需手动移动文件，爬虫和分析模块使用统一的数据目录
- **本地模式**：当网站不稳定或需要重复解析时，可将网页保存为HTML文件（如 `response.html`），放在项目根目录，然后使用本地模式爬取
- 本地HTML文件路径支持相对路径（相对于项目根目录）和绝对路径

### 2. 运行情感分析

#### 方式一：命令行分析

```bash
cd analyze
python run_analysis.py
```

**说明**：
- 可以在任意目录运行，程序会自动定位到正确的路径
- 分析结果保存在 `analyze/analysis_result.json`

#### 方式二：启动Web可视化

```bash
cd analyze
python api_server.py
```

然后在浏览器中访问：http://localhost:5000


## 分析维度

1. **整体情感分析**
   - 情感得分（0-1）
   - 情感分类（正面/负面/中性）
   - 情感强度

2. **关键词分析**
   - TF-IDF关键词提取
   - 关键词权重排序

3. **时间维度**
   - 情感随时间变化趋势
   - 评论时间分布

4. **作者维度**
   - 不同评论者的情感倾向
   - 评论者活跃度统计

5. **统计维度**
   - 帖子数量统计
   - 评论数量统计
   - 情感分布统计

## API接口
### GET /api/overall
获取总体统计信息
### GET /api/posts
获取所有帖子分析结果
### GET /api/keywords
获取关键词列表
### GET /api/post/<post_id>
获取单个帖子详细分析
### GET /api/refresh
刷新分析结果

## 本地模式使用场景

当遇到以下情况时，推荐使用本地模式：

1. **网站不稳定**：豆瓣网站访问不稳定或频繁超时
2. **开发调试**：需要反复测试解析逻辑，避免重复请求网站
3. **数据备份**：已经保存了网页HTML，想要离线解析
4. **避免封禁**：减少对网站的请求频率

### 如何获取本地HTML文件

1. 打开浏览器访问豆瓣帖子页面
2. 右键 → "保存为" → 保存完整网页
3. 将HTML文件保存到项目根目录（或任意位置）
4. 使用 `--mode local --file <文件路径>` 运行

## 注意事项
1. 请遵守豆瓣的使用条款，不要过度频繁请求
2. 首次运行snownlp需要下载模型，可能需要一些时间
3. 分析大量数据时建议使用缓存机制
4. 情感分析结果仅供参考
5. 本地模式只能解析单个HTML文件，如需批量爬取建议使用远程模式
